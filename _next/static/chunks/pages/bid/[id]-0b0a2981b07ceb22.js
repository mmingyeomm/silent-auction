(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[216],{3569:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/bid/[id]",function(){return n(6135)}])},9361:function(e,t,n){"use strict";var a=n(5893);n(7294);var i=n(9008),r=n.n(i),o=n(1664),s=n.n(o),c=n(2003),l=n.n(c);t.Z=e=>{let{title:t="SilentAuction",description:n="Bid on exciting items!"}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r(),{children:[(0,a.jsx)("title",{children:t}),(0,a.jsx)("meta",{name:"description",content:n}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsxs)("header",{className:l().header,children:[(0,a.jsx)(s(),{href:"/",children:(0,a.jsx)("h1",{children:"Silent-Auction"})}),(0,a.jsxs)("nav",{children:[(0,a.jsx)(s(),{href:"/",children:"Home"}),(0,a.jsx)(s(),{href:"/auctions",children:"Live Auctions"}),(0,a.jsx)(s(),{href:"/create",children:"Create New Auction"}),(0,a.jsx)(s(),{href:"/finished-auctions",children:"Finished Auctions"})]})]})]})}},6135:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var a=n(5893),i=n(7294),r=n(1163),o=n(561),s=n.n(o),c=n(9466);class l{_call(e,t){return new Promise((n,a)=>{if(!this.worker){a(Error("Worker is not initialized - browser environment required"));return}this.promises[this.nextId]={resolve:n,reject:a};let i={id:this.nextId,fn:e,args:t};try{this.worker.postMessage(i),this.nextId++}catch(e){delete this.promises[this.nextId],a(e)}})}async setActiveInstanceToDevnet(){return await this._call("setActiveInstanceToDevnet",{})}async loadContract(){return await this._call("loadContract",{})}async compileContract(){return await this._call("compileContract",{})}async fetchAccount(e){let{publicKey:t}=e;return await this._call("fetchAccount",{publicKey58:t.toBase58()})}async initZkappInstance(e){return await this._call("initZkappInstance",{publicKey58:e.toBase58()})}async getMerkleMapRoot(){let e=await this._call("getMerkleMapRoot",{});return c.gN.fromJSON(JSON.parse(e))}async createUpdateRootTransaction(e,t,n){return await this._call("createUpdateRootTransaction",{key:e,value:t,fetchedmerklemap:n})}isWorkerAvailable(){return null!==this.worker}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.promises={}}constructor(){this.promises={},this.nextId=0,this.worker=null;try{this.worker=new Worker(n.tu(new URL(n.p+n.u(718),n.b))),this.worker.onmessage=e=>{this.promises[e.data.id].resolve(e.data.data),delete this.promises[e.data.id]},this.worker.onerror=e=>{console.error("Worker error:",e),Object.keys(this.promises).forEach(t=>{this.promises[Number(t)].reject(e)})}}catch(e){console.error("Failed to initialize worker:",e)}}}var d=n(9361),u=n(3454);function h(){let e=(0,r.useRouter)(),t=u.env.NEXT_PUBLIC_BACKEND_URL,{id:n}=e.query,[o,h]=(0,i.useState)(null),[_,m]=(0,i.useState)(null),[p,x]=(0,i.useState)(null),[f,g]=(0,i.useState)(""),[w,j]=(0,i.useState)(""),[k,b]=(0,i.useState)(!0),[y,N]=(0,i.useState)(null),[v,B]=(0,i.useState)(null),[I,M]=(0,i.useState)({zkappWorkerClient:null,hasWallet:null,hasBeenSetup:!1,accountExists:!1,currentNum:null,publicKey:null,zkappPublicKey:null,creatingTransaction:!1}),C=new l;(0,i.useEffect)(()=>{n&&S()},[n]);let S=async()=>{try{b(!0);let e=await fetch("".concat(t,"/items/").concat(n));if(!e.ok)throw Error("Failed to fetch auction details");let a=await e.json();h(a),b(!1)}catch(e){N("Error fetching auction details. Please try again later."),b(!1)}},H=(0,i.useCallback)(async e=>{e.preventDefault(),I.hasBeenSetup||(g("Setting up ZkApp..."),await E()),g("Fetching MerkleMap...");let a=await T(Number(n));console.log("Fetched MerkleMapRoot:",a);let i=await C.getMerkleMapRoot();console.log("current Contract MerkleMapRoot"+i),g("Creating transaction..."),M({...I,creatingTransaction:!0}),console.log("Placing bid of $".concat(_," on auction ").concat(n));try{console.log("GetCurrent MerkleRoot");let e=window.mina;if(null==e){M({...I,hasWallet:!1});return}let r=await e.requestAccounts(),o=c.nh.fromBase58(r[0]),s=await C.createUpdateRootTransaction(p,_,a),{hash:l}=await window.mina.sendTransaction({transaction:s,feePayer:{fee:.1,memo:""}});console.log("publickey"+o.toBase58());let d="https://minascan.io/devnet/tx/".concat(l);console.log("View transaction at ".concat(d)),M({...I,creatingTransaction:!1}),B({key:p,amount:_,transactionHash:d,merkleMapRoot:i.toString(),timestamp:new Date().toISOString()});let u=await fetch("".concat(t,"/auction-log/add"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemId:n,key:p,bidUser:o.toBase58(),bidAmount:_,transactionHash:l})});if(!u.ok)throw Error("Failed to save auction log");let h=await u.text();console.log(h),g("Bid placed successfully!"),M({...I,creatingTransaction:!1})}catch(e){console.error(e),g("Error creating transaction"),M({...I,creatingTransaction:!1})}},[I,_,n]);async function T(e){let t=u.env.NEXT_PUBLIC_BACKEND_URL;console.log(e);try{let n=await fetch("".concat(t,"/auction-log/merklemap"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemId:e})});if(!n.ok)throw Error("Failed to fetch MerkleMap");return await n.text()}catch(e){throw console.error("Failed to fetch MerkleMap:",e),e}}let E=async()=>{await C.setActiveInstanceToDevnet();let e=window.mina;if(null==e){M({...I,hasWallet:!1});return}let t=await e.requestAccounts(),n=c.nh.fromBase58(t[0]),a=null==(await C.fetchAccount({publicKey:n})).error;await C.loadContract(),await C.compileContract();let i=c.nh.fromBase58("B62qjYDFfZWN7xXH7EP3jUX4JMqFQ3ntynFLwUKUTCKE6hXxC2xSDfR");await C.initZkappInstance(i),await C.fetchAccount({publicKey:i});let r=await C.getMerkleMapRoot();await M({...I,zkappWorkerClient:C,hasWallet:!0,hasBeenSetup:!0,publicKey:n,zkappPublicKey:i,accountExists:a,currentNum:r})};return o?(0,a.jsxs)("div",{className:s().container,children:[(0,a.jsx)("header",{className:s().header,children:(0,a.jsx)(d.Z,{})}),(0,a.jsxs)("main",{className:s().main,children:[(0,a.jsx)("h1",{className:s().title,children:"Create Bid"}),k?(0,a.jsx)("div",{className:"".concat(s().statusMessage," ").concat(s().loading),children:"Loading auction details..."}):y?(0,a.jsx)("div",{className:"".concat(s().statusMessage," ").concat(s().error),children:y}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{className:s().title,children:null==o?void 0:o.title}),(0,a.jsxs)("div",{className:s().auctionDetails,children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{children:"Minimum Price:"}),(0,a.jsxs)("span",{children:[null==o?void 0:o.minimumPrice," MINA"]})]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{children:"Ends at:"}),(0,a.jsx)("span",{children:new Date((null==o?void 0:o.endTime)||"").toLocaleString()})]})]}),(0,a.jsxs)("form",{onSubmit:H,className:s().bidForm,children:[(0,a.jsx)("input",{type:"number",value:null===p?"":p,onChange:e=>{let t=e.target.value;x(""===t?null:Number(t))},placeholder:"Enter your bid key",required:!0}),(0,a.jsx)("input",{type:"number",value:null===_?"":_,onChange:e=>{let t=e.target.value;m(""===t?null:Number(t))},placeholder:"Enter bid amount",required:!0}),(0,a.jsx)("button",{type:"submit",disabled:I.creatingTransaction,children:I.creatingTransaction?"Processing...":"Place Bid"})]}),v&&(0,a.jsxs)("div",{className:s().bidInfoContainer,children:[(0,a.jsx)("h3",{className:s().bidInfoTitle,children:"Bid Information"}),(0,a.jsxs)("div",{className:s().bidInfoContent,children:[(0,a.jsxs)("div",{className:s().bidInfoItem,children:[(0,a.jsx)("span",{children:"Bid Key:"}),(0,a.jsx)("span",{children:v.key})]}),(0,a.jsxs)("div",{className:s().bidInfoItem,children:[(0,a.jsx)("span",{children:"Bid Amount:"}),(0,a.jsxs)("span",{children:[v.amount," MINA"]})]}),(0,a.jsxs)("div",{className:s().bidInfoItem,children:[(0,a.jsx)("span",{children:"Transaction:"}),(0,a.jsx)("a",{href:"https://minascan.io/devnet/tx/".concat(v.transactionHash),target:"_blank",rel:"noopener noreferrer",className:s().transactionLink,children:"View Transaction"})]}),(0,a.jsxs)("div",{className:s().bidInfoItem,children:[(0,a.jsx)("span",{children:"Merkle Map Root:"}),(0,a.jsx)("span",{className:s().merkleRoot,children:v.merkleMapRoot})]}),(0,a.jsxs)("div",{className:s().bidInfoItem,children:[(0,a.jsx)("span",{children:"Timestamp:"}),(0,a.jsx)("span",{children:new Date(v.timestamp).toLocaleString()})]})]})]}),f&&(0,a.jsx)("div",{className:"".concat(s().statusMessage," ").concat(f.includes("successfully")?s().success:f.includes("Error")?s().error:s().loading),children:f})]})]}),(0,a.jsx)("footer",{className:s().footer,children:(0,a.jsx)("p",{children:"\xa9 2024 Silent-Auction. All rights reserved."})})]}):(0,a.jsx)("div",{children:"Loading..."})}},561:function(e){e.exports={container:"Bid_container__axGhi",main:"Bid_main__WpZlK",title:"Bid_title__0WMWb",auctionDetails:"Bid_auctionDetails__X5ldo",bidForm:"Bid_bidForm__RV9Cc",statusMessage:"Bid_statusMessage__Ant_V",loading:"Bid_loading__uLrcv",error:"Bid_error__uLpcV",success:"Bid_success__HRf_d",footer:"Bid_footer__czPcI"}},2003:function(e){e.exports={container:"Home_container__9OuOz",main:"Home_main__2uIek",title:"Home_title__YEn0u",background:"Home_background__CTycG",backgroundGradients:"Home_backgroundGradients__VUGb4",tagline:"Home_tagline__Jw01K",start:"Home_start__ELciH",code:"Home_code__BZK8z",grid:"Home_grid__vo_ES",card:"Home_card__HIlp_",center:"Home_center__Y_rV4",logo:"Home_logo__ZEOng",content:"Home_content__Qnbja",header:"Home_header__ZUWxe",footer:"Home_footer__wJNRn",description:"Home_description__zHUB6",hero:"Home_hero__g_og0",button:"Home_button__Mzpzz",auctionScrollContainer:"Home_auctionScrollContainer__zehpG",auctionGrid:"Home_auctionGrid___V5p_",auctionBox:"Home_auctionBox__PbP2x",chartContainer:"Home_chartContainer__SoXyb"}},1163:function(e,t,n){e.exports=n(9090)}},function(e){e.O(0,[674,996,888,774,179],function(){return e(e.s=3569)}),_N_E=e.O()}]);